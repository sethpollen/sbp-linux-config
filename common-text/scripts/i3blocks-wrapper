#!/usr/bin/env fish
#
# Sometimes i3blocks terminates with exit status zero for a reason I don't
# understand (see https://github.com/vivien/i3blocks/issues/388). As a
# workaround, we call it in a loop here. On all but the first invocation, we
# suppress the first 2 lines (which start the infinite JSON list).

rm ~/log/i3blocks.stderr ~/log/i3blocks.stdout ~/log/i3blocks2.stdout

# TODO: remove logging
i3blocks -vv 2>~/log/i3blocks.stderr | tee ~/log/i3blocks.stdout
or exit

# i3blocks exited with status zero.
while true
  # TODO: remove logging
  i3blocks | tee ~/log/i3blocks2.stdout | tail -n +2 | tee ~/log/i3blocks3.stdout
  or exit

  # TODO: remove logging
  touch ~/log/i3blocks-wrapper-retry
end

# TODO: remove logging
touch ~/log/i3blocks-wrapper-exit
